# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. "int" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è awaitable / "str" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è awaitable

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `await` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ Redis

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞ Redis:

```python
# –í utils/redis_client.py

async def push_message(conversation_id: str, message: Dict[str, Any], max_len: int = 200) -> None:
    try:
        r, is_async = await get_redis()  # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∏–µ–Ω—Ç –∏ –µ–≥–æ —Ç–∏–ø
        
        if is_async:
            # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API - –∏—Å–ø–æ–ª—å–∑—É–µ–º await
            await r.rpush(key, msg_json)
            await r.ltrim(key, -max_len, -1)
            await r.expire(key, 60 * 60 * 24 * 7)
        else:
            # –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API - –≤—ã–ø–æ–ª–Ω—è–µ–º –≤ executor
            await loop.run_in_executor(None, _push)
    except Exception as e:
        print(f"Warning: Redis push failed: {e}")
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å Redis

- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø Redis –∫–ª–∏–µ–Ω—Ç–∞ (async/sync)
- –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `run_in_executor`
- –î–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è await-–≤—ã–∑–æ–≤—ã
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ Redis –∏–º–µ—é—Ç try-except –±–ª–æ–∫–∏:
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ù–µ –∫—Ä–∞—à–∏—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ Redis

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```python
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python main.py

# –ë–æ—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –±–µ–∑ Redis
# Redis –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install 'redis[hiredis]'
```

–û—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! ‚úÖ

